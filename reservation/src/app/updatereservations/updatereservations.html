<div class="container">
  <div class="toolbar">
  <h2>{{ userName }}'s UpdateReservation</h2>
  <button (click)="authService.logout()" class="btn btn-sm btn-danger">Logout</button>
  </div>
  <form #f="ngForm" (ngSubmit)="updateReservation(f)">

    <div class="form-group">
      <label>First Name</label>
      <input type="text" name="firstName" class="form-control" [(ngModel)]="reservation.firstName" required maxlength="50">
      <div *ngIf="f.controls['firstName']?.errors?.['maxlength'] && f.controls['firstName']?.touched" class="alert alert-danger">
        First Name cannot exceed 50 characters.
      </div>
    </div>

    <div class="form-group">
      <label>Last Name</label>
      <input type="text" name="lastName" class="form-control" [(ngModel)]="reservation.lastName" required maxlength="50">
      <div *ngIf="f.controls['lastName']?.errors?.['maxlength'] && f.controls['lastName']?.touched" class="alert alert-danger">
        Last Name cannot exceed 50 characters.
      </div>
    </div>

    <div class="form-group">
      <label>Email Address</label>
      <input type="email" name="emailAddress" class="form-control" [(ngModel)]="reservation.emailAddress" required maxlength="100">
      <div *ngIf="f.controls['emailAddress']?.errors?.['maxlength'] && f.controls['emailAddress']?.touched" class="alert alert-danger">
        Email cannot exceed 100 characters.
      </div>
    </div>

    <div class="form-group">
      <label>Phone</label>
      <input type="text" name="phone" class="form-control" [(ngModel)]="reservation.phone" required maxlength="15"
      pattern="^(\(\d{3}\)\s|\d{3}-)\d{3}-\d{4}$" />
      <div *ngIf="f.controls['phone']?.errors?.['maxlength'] && f.controls['phone']?.touched" class="alert alert-danger">
        Phone cannot exceed 15 characters.
      </div>
    </div>

    <div class="form-group">
      <label>Status</label>
      <select name="status" class="form-control" [(ngModel)]="reservation.status" required>
        <option value="member">Member</option>
        <option value="nonmember">NonMember</option>
      </select>
    </div>

    <div class="form-group">
      <label>Area</label>
      <select name="area" class="form-control" [(ngModel)]="reservation.area" required>
        <option *ngFor="let area of areas" [value]="area">{{ area }}</option>
      </select>
    </div>

    <div class="form-group">
      <label>Time</label>
      <select name="time" class="form-control" [(ngModel)]="reservation.time" required>
        <option *ngFor="let slot of timeSlots" [value]="slot">{{ slot }}</option>
      </select>
    </div>

    <div class="form-group">
      <label>Date</label>
      <input type="date" name="date" class="form-control" [(ngModel)]="reservation.date" required>
    </div>

    <div class="form-group">
      <label>Current or New Image Preview</label><br>
      <img
        [src]="previewUrl ? previewUrl : 'http://localhost/AngularApp2/reservationapi/uploads/' + reservation.imageName"
        alt="Contact Image"
        width="100"
        height="100"
        class="mb-3 border rounded"
      />
    </div>

    <div class="form-group">
      <label>Upload New Image</label>
      <input type="file" name="image" class="form-control" (change)="onFileSelected($event)">
    </div>

    <button type="submit" class="btn btn-primary" [disabled]="f.invalid">Update</button>
    <button class="btn btn-secondary" routerLink="/reservations">Cancel</button>

    <div *ngIf="success" class="alert alert-success mt-3">{{ success }}</div>
    <div *ngIf="error" class="alert alert-danger mt-3">{{ error }}</div>
  </form>
</div>
